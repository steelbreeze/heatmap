<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="Cache-Control" content="no-store" />
	<title>Dynamic test</title>
</head>

<body>
	<h1>1. Select source data</h1>
	<form>
		<input id="filePicker" type="file" accept="text/csv">
	</form>
	<script type="module">
		import * as d3 from "https://cdn.skypack.dev/d3-dsv@3";
		import * as pivot from 'https://cdn.skypack.dev/@steelbreeze/pivot?min';
		import * as landscape from 'https://cdn.skypack.dev/@steelbreeze/landscape?min';

		// add a listener to the file picker control to load the file once selected
		document.getElementById('filePicker').addEventListener('change', source => loadFile(source.target.files[0]));

		/**
		 * Loads a file
		 */
		function loadFile(file) {
			var reader = new FileReader();

			reader.onload = evt => fileLoaded(evt.target.result);

			reader.readAsText(file);
		}

		/**
		 * Called on a successful file load
		 */
		function fileLoaded(data) {
			const json = d3.csvParse(data);

			console.log(json);

			const attributes = Object.getOwnPropertyNames(json[0]);

			const xAxis = pivot.deriveDimension(json, attributes[0]);
			const yAxis = pivot.deriveDimension(json, attributes[1]);

			console.log(xAxis);
			console.log(yAxis);
		}
	</script>
</body>

</html>